# WinLink Migrator 项目开发规范文档
## 1. 项目概况
WinLink 迁移器是一个 Windows 实用工具仪表盘，旨在帮助用户将应用程序数据从系统盘（C盘）迁移到其他分区，并通过创建符号链接（Symbolic Links / Junctions）保持原有路径的访问性。项目集成 Google Gemini AI，用于评估迁移操作的安全性。
当前版本为 Web POC（概念验证），专注于展示 UI 交互、状态流程及 AI 集成，实际文件操作需要在 Tauri 环境下运行。
## 2. 技术栈架构
- 前端框架: React 19（React, react-dom）
- 开发语言: TypeScript
- 样式方案: Tailwind CSS（通过 CDN 引入）
- 图标库: Lucide React
- AI 服务: Google GenAI SDK（@google/genai - Gemini 1.5 闪光版 专业版）
- 构建/运行环境: 浏览器（当前），目标为 Tauri

### 2.1 建议与优化
#### 技术栈优化
- **Tailwind CSS**: 考虑从 CDN 引入改为 npm 安装配置，以便使用自定义主题和插件
- **状态管理**: 添加状态管理库（如 Zustand、Jotai 或 Redux Toolkit）以更好地管理应用状态
- **构建工具**: 使用 Vite 作为构建工具，提供更快的开发体验和构建速度
- **包管理器**: 考虑使用 pnpm 以提高依赖管理效率和减少磁盘占用
- **TypeScript 配置**: 配置更严格的 TypeScript 规则，提高代码质量
- **测试框架**: 添加测试框架（如 Vitest、React Testing Library）以确保代码质量
- **代码规范**: 集成 ESLint 和 Prettier 以保持代码风格一致
- **CI/CD**: 添加 GitHub Actions 配置，实现自动化测试和构建
## 3. 核心数据模型(Type Definitions)
所有核心类型定义位于 types.ts。
### 3.1 应用状态流程（应用状态）
应用在迁移过程中经历以下状态：
- 准备好: 就绪，等待操作。
- 分析: 正在进行 AI 安全分析。
- 移动: 正在执行迁移流程（包含详细步骤）。
- 已移动: 迁移及链接创建成功。
- 错误: 操作失败。
### 3.2 迁移细分步骤（移动步）
当状态为移动时，UI 需展示具体的底层操作进度：
- 闲置的: 未开始。
- MKDIR: 创建目标目录。
- 机器复制: 复制文件数据。
- MKLINK: 创建 Junction 链接。
- 完毕: 完成。
### 3.3 应用数据结构（应用程序文件夹）

```typescript
interface AppFolder {
  id: string;
  name: string;
  sourcePath: string; // 原路径
  size: string;       // 占用空间
  status: AppStatus;
  moveStep?: MoveStep;
  safetyScore?: number; // AI 评分 (0-100)
  aiAnalysis?: string;  // AI 分析建议
}
```

### 3.4 建议与优化
#### 核心数据模型优化

##### AppStatus 扩展
- **暂停状态**: 添加 `暂停` 状态，允许用户在迁移过程中暂停操作
- **验证状态**: 添加 `验证` 状态，用于验证迁移后的数据完整性

##### AppFolder 扩展
- **目标路径**: 添加 `targetPath` 字段，存储迁移目标路径
- **迁移大小**: 添加 `migratedSize` 字段，实时显示已迁移大小
- **错误信息**: 添加 `errorMessage` 字段，存储错误详细信息
- **最后修改时间**: 添加 `lastModified` 字段，存储文件最后修改时间
- **备份路径**: 添加 `backupPath` 字段，存储备份文件路径

##### 新增数据模型
- **迁移配置**: 添加 `MigrationConfig` 接口，存储用户迁移配置偏好
- **终端日志**: 添加 `TerminalLogEntry` 接口，存储操作日志
- **磁盘信息**: 添加 `DiskInfo` 接口，存储磁盘信息
- **AI 分析结果**: 添加 `AiAnalysisResult` 接口，存储详细的 AI 分析结果
## 4. 功能模块拆解

### 4.1 磁盘扫描模块
- **功能**: 扫描系统磁盘和应用程序
- **实现**: diskScanService.ts + diskService.ts
- **流程**: 启动应用 → 扫描磁盘 → 选择磁盘 → 扫描应用 → 显示结果
- **关键点**:
  - 异步扫描，避免阻塞 UI
  - 扫描进度实时反馈
  - 应用程序大小计算
  - 支持多磁盘切换

### 4.2 AI 安全分析模块
- **功能**: 分析应用程序安全性
- **实现**: geminiService.ts
- **流程**: 选择应用 → 启动分析 → AI 处理 → 显示结果
- **关键点**:
  - 集成 Google Gemini AI
  - 安全评分计算
  - 分析结果可视化
  - 错误处理和降级策略

### 4.3 应用迁移模块
- **功能**: 迁移应用程序到目标磁盘
- **实现**: migrationService.ts
- **流程**: 选择应用 → 配置迁移 → 执行迁移 → 显示结果
- **关键点**:
  - 执行 Windows 命令（robocopy, mklink）
  - 迁移进度实时反馈
  - 支持批量迁移
  - 支持取消和回滚

### 4.4 终端日志模块
- **功能**: 显示操作过程和系统事件
- **实现**: logService.ts + TerminalLog.tsx
- **流程**: 系统事件发生 → 创建日志条目 → 显示在终端组件
- **关键点**:
  - 不同类型日志的颜色区分
  - 自动滚动到最新日志
  - 日志类型管理（信息、成功、警告、错误、命令）

### 4.5 国际化模块
- **功能**: 支持多语言切换
- **实现**: translations.ts + translations/ 目录
- **流程**: 用户选择语言 → 系统更新界面文本 → 持久化语言偏好
- **关键点**:
  - 支持中文和英文
  - 文本翻译管理
  - 语言切换无刷新

### 4.6 主题管理模块
- **功能**: 支持不同主题模式
- **实现**: themeService.ts
- **流程**: 用户选择主题 → 系统更新界面样式 → 持久化主题偏好
- **关键点**:
  - 支持浅色、深色和系统主题
  - 主题切换无刷新
  - 样式一致性
## 5. 开发规范与最佳实践

### 5.1 代码风格
- **TypeScript**: 使用严格模式，避免 any 类型
- **命名规范**:
  - 组件名: PascalCase
  - 函数名: camelCase
  - 变量名: camelCase
  - 常量名: UPPER_CASE_WITH_UNDERSCORES
  - 文件名: PascalCase（组件），kebab-case（其他）
- **缩进**: 使用 2 个空格
- **行尾**: 使用 CRLF
- **引号**: 使用单引号

### 5.2 组件开发
- **组件设计**: 遵循单一职责原则，组件应只负责一个功能
- **Props 类型**: 为所有组件 Props 定义 TypeScript 接口
- **状态管理**: 优先使用 React Hooks，复杂状态考虑使用状态管理库
- **副作用**: 正确使用 useEffect，避免内存泄漏
- **样式**: 使用 Tailwind CSS，避免内联样式

### 5.3 服务开发
- **服务设计**: 采用单例模式，提供统一的服务接口
- **错误处理**: 所有异步操作应包含错误处理
- **日志记录**: 重要操作应记录日志
- **性能考虑**: 避免重复计算，考虑缓存机制

### 5.4 测试规范
- **测试覆盖**: 核心功能应达到 80% 以上的测试覆盖率
- **测试类型**:
  - 单元测试: 测试独立函数和组件
  - 集成测试: 测试模块间交互
  - 端到端测试: 测试完整用户流程
- **测试命名**: 测试文件命名为 `*.test.ts` 或 `*.spec.ts`

### 5.5 版本控制
- **分支管理**:
  - main: 主分支，用于稳定发布
  - dev: 开发分支，用于持续开发
  - feature/*: 特性分支，用于新功能开发
  - fix/*: 修复分支，用于 bug 修复
- **提交规范**: 使用语义化提交消息，格式为 `<类型>: <描述>`
  - 类型: feat（新功能）、fix（修复）、docs（文档）、style（样式）、refactor（重构）、test（测试）、chore（构建/依赖）
- **提交频率**: 小步提交，每个提交应只包含一个逻辑更改

### 5.6 文档规范
- **项目文档**: 保持 openspec 目录下的文档更新
- **代码注释**: 为复杂函数和组件添加注释
- **README 文件**: 每个模块应包含 README 文件，说明模块功能和使用方法

### 5.7 安全规范
- **API 密钥**: 不在代码中硬编码 API 密钥，使用环境变量
- **权限管理**: 正确处理 Windows 文件系统权限
- **输入验证**: 验证所有用户输入，避免注入攻击
- **数据保护**: 保护用户敏感数据，避免泄露

### 5.8 性能优化
- **代码分割**: 使用动态导入，减少初始加载时间
- **虚拟滚动**: 对于长列表，使用虚拟滚动提高性能
- **缓存策略**: 合理使用缓存，避免重复计算
- **网络请求**: 优化网络请求，避免不必要的请求
- **渲染优化**: 使用 React.memo、useMemo、useCallback 等优化渲染性能

### 5.9 部署规范
- **构建流程**: 定义清晰的构建流程，确保构建产物一致性
- **环境配置**: 为不同环境（开发、测试、生产）配置不同的环境变量
- **部署策略**: 定义部署策略，确保部署过程安全可靠
- **版本管理**: 使用语义化版本号，遵循版本发布规范

### 5.10 团队协作
- **代码审查**: 所有代码更改应经过代码审查
- **问题跟踪**: 使用 GitHub Issues 跟踪问题和任务
- **项目管理**: 使用 GitHub Projects 管理项目进度
- **沟通机制**: 建立清晰的沟通机制，确保团队协作顺畅

## 6. 项目结构

```
WinLink/
├── src/
│   ├── components/          # React 组件
│   │   ├── AppCard.tsx      # 应用卡片组件
│   │   └── TerminalLog.tsx  # 终端日志组件
│   ├── constants/           # 常量定义
│   ├── services/            # 服务层
│   │   ├── analysisHistoryService.ts  # 分析历史服务
│   │   ├── diskScanService.ts         # 磁盘扫描服务
│   │   ├── diskService.ts             # 磁盘服务
│   │   ├── geminiService.ts           # Gemini AI 服务
│   │   ├── logService.ts              # 日志服务
│   │   ├── migrationService.ts        # 迁移服务
│   │   └── themeService.ts            # 主题服务
│   ├── styles/              # 样式文件
│   ├── translations/        # 国际化文件
│   │   ├── en.json          # 英文翻译
│   │   ├── zh.json          # 中文翻译
│   │   └── index.ts         # 翻译索引
│   ├── types/               # TypeScript 类型定义
│   ├── utils/               # 工具函数
│   ├── App.tsx              # 主应用组件
│   ├── index.tsx            # 应用入口
│   └── translations.ts      # 国际化配置
├── openspec/                # 项目规范/文档
├── public/                  # 静态资源
├── tests/                   # 测试文件
├── package.json             # 项目配置
├── tsconfig.json            # TypeScript 配置
├── vite.config.ts           # Vite 配置
└── tailwind.config.js       # Tailwind 配置
```

## 7. 开发环境搭建

### 7.1 依赖安装
```bash
# 使用 npm
npm install

# 或使用 yarn
yarn install

# 或使用 pnpm
pnpm install
```

### 7.2 开发服务器
```bash
# 使用 npm
npm run dev

# 或使用 yarn
yarn dev

# 或使用 pnpm
pnpm dev
```

### 7.3 构建项目
```bash
# 使用 npm
npm run build

# 或使用 yarn
yarn build

# 或使用 pnpm
pnpm build
```

### 7.4 运行测试
```bash
# 使用 npm
npm run test

# 或使用 yarn
yarn test

# 或使用 pnpm
pnpm test
```

## 8. 未来规划

### 8.1 功能规划
- **Tauri 集成**: 迁移到 Tauri 环境，实现原生文件操作
- **高级迁移选项**: 添加更多迁移选项，如增量迁移、选择性迁移
- **AI 分析增强**: 改进 AI 分析能力，提供更详细的安全建议
- **备份与恢复**: 添加应用程序备份和恢复功能
- **多语言支持**: 支持更多语言的国际化
- **系统托盘集成**: 添加系统托盘图标，支持后台运行
- **自动迁移**: 基于使用情况，自动建议和执行迁移

### 8.2 技术规划
- **性能优化**: 进一步优化应用性能，特别是大型文件迁移
- **安全性增强**: 加强应用安全性，保护用户数据
- **可访问性**: 提高应用可访问性，支持更多用户群体
- **扩展性**: 设计插件系统，支持功能扩展
- **云集成**: 集成云存储服务，支持云备份和恢复

### 8.3 发布规划
- **Alpha 版本**: 基本功能实现，内部测试
- **Beta 版本**: 功能完善，公开测试
- **1.0 版本**: 稳定发布，正式版
- **后续版本**: 持续迭代，添加新功能

## 9. 总结
WinLink Migrator 是一个旨在解决 Windows 用户系统盘空间不足问题的实用工具，通过智能分析和安全迁移，帮助用户释放系统盘空间，同时保持应用程序的正常运行。项目采用现代化的技术栈和架构设计，具有良好的扩展性和可维护性。

通过本规范文档，我们希望为开发团队提供清晰的指导，确保项目开发过程的一致性和高效性，最终交付一个高质量的产品给用户。