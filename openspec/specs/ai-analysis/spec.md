# AI 分析规范

## 描述
AI 分析功能利用 Google Gemini AI 评估迁移应用程序数据的安全性能。它为用户提供风险评估和建议，帮助他们就迁移哪些应用程序做出明智的决策。
## 需求
### 需求：AI 安全分析
系统应使用 Google Gemini AI 分析迁移应用程序数据的安全性能。
#### 场景：分析启动
- **WHEN** 用户点击 "Analyze Safety"
- **THEN** 系统应将应用程序文件元数据发送到 AI 服务
- **AND** 显示分析状态
#### 场景：分析通知
- **WHEN** 从 AI 接收数据
- **THEN** 系统应包含查询编码路径、系统服务和符合 junction 链接的通知
#### 场景：分析结果
- **WHEN** AI 分析完成
- **THEN** 系统应显示安全评估和分析结果
- **AND** 相应更新应用程序状态
### 需求：输出格式标准化
系统应确保 AI 分析结果使用一致的 JSON 结构。
#### 场景：JSON 结构输出
- **WHEN** 请求 AI 分析
- **THEN** 系统应在提示中指定 JSON 结构
- **AND** 期望 AI 以该格式返回结果

#### 场景：结果解析
- **WHEN** 接收 AI 结果
- **THEN** 系统应解析 JSON 响应
- **AND** 提取风险等级和建议
### 需求：错误处理
当 AI 分析失败时，系统应优雅地处理错误。
#### 场景：API 密钥丢失
- **WHEN** AI 服务 API 密钥丢失
- **THEN** 系统应返回默认的 "Medium Risk" 评估
- **AND** 显示相应的错误消息
#### 场景：请求失败
- **WHEN** AI 服务请求失败
- **THEN** 系统应返回默认的 "Medium Risk" 评估
- **AND** 显示相应的错误消息
### 需求：增强 AI 分析功能
系统应提供增强的 AI 分析功能，以提高用户体验和效率。
#### 场景：批量分析
- **WHEN** 用户选择多个应用程序
- **THEN** 系统应支持同时分析所有选定的应用程序
- **AND** 显示每个应用程序的进度
#### 场景：分析历史
- **WHEN** 执行 AI 分析
- **THEN** 系统应保存分析结果
- **AND** 允许用户查看历史分析

#### 场景：离线分析模式
- **WHEN** 无网络连接可用
- **THEN** 系统应使用基于本地规则的分析
- **AND** 显示有关有限分析功能的说明
#### 场景：分析深度选择
- **WHEN** 启动分析
- **THEN** 系统应支持用户选择分析深度（快速/标准/深度）
- **AND** 相应调整分析过程

#### 场景：自定义提示配置
- **WHEN** 高级用户配置设置
- **THEN** 系统应支持自定义 AI 分析提示
- **AND** 对后续分析使用自定义提示

## 数据结构

### AiAnalysisResult
```typescript
interface AiAnalysisResult {
  riskLevel: 'low' | 'medium' | 'high';
  confidence: number;
  recommendations: string[];
  warnings: string[];
  safe: boolean;
}
```

## 实现注意事项

### API 集成
- 系统应通过 HTTP 客户端与 Google Gemini API 交互
- 实现 API 调用的重试机制，以处理临时网络故障
- 确保 API 密钥安全存储，不在前端代码中暴露

### 性能优化
- 实现分析结果的缓存，避免重复分析同一应用程序
- 使用节流和防抖技术，防止用户频繁触发分析
- 考虑在后台线程中执行分析，以保持 UI 响应性

### 安全性
- 确保发送到 AI 服务的数据不包含敏感信息
- 实现数据最小化原则，只发送必要的元数据
- 对 AI 服务的响应进行验证，确保其符合预期格式